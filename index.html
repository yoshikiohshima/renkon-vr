<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"> 
    </head>
    <body>
        <div id="renkon">
            <script type="reactive">
                const hostName = (() => {
                    const maybeHost = new URL(window.location).searchParams.get("host")
                    if (maybeHost) {
                        return maybeHost;
                    }
                    return "/";
                })();

                const {h, render, html} = import(Renkon.spaceURL("./preact.standalone.module.js"));
                const {ReflectCommands} = import(`${hostName}/tool-call/js/commands.js`);

                const reflectResponse = new ReflectCommands(hostName + "/tool-call").reflect();

                const commandList = {
                    "cursor_next_line": {
                        "description": "Move the cursor to n lines down the current line",
                        "parameters": {
                            "nLines": {
                                "type": "number",
                                "description": "The amount of movement.",
                            },
                        },
                        "returns": {
                            "ok": {type: "boolean"}
                        }
                    },
                    "type_in": {
                        "description": "Type in the argument at the current cursor position",
                        "parameters": {
                            "input": {
                                "type": "string",
                                "description": "The string to be entered."
                            }
                        },
                        "return": {
                            "ok": {type: "boolean"}
                        }
                    }
                }

                const input = "move the cursor three lines down";

                const commandResponse = ((reflectResponse, commandList, input) => {
                    const cmd = reflectResponse["suggest"];
                    if (!cmd) {return;}
                    return cmd.run({commands: commandList, input});
                })(reflectResponse, commandList, input);
                
                ((commandResponse) => {
                    console.log(commandResponse);
                    if (commandResponse?.choices[0]) {
                        const div = document.createElement("div");
                        const result = commandResponse?.choices[0];
                        const str = `${result.command}(${Object.keys(result.parameters).map((k) => result.parameters[k])})`;
                        div.textContent = str;
                        const br = document.createElement("br");
                        const renkon = document.querySelector("#renkon");
                        renkon.appendChild(div);
                        renkon.appendChild(br);
                    }
                    })(commandResponse);
            </script>
        </div>
        <script type="module">
            import {view, newInspector} from "./renkon.js";
            view({app: {newInspector}});
        </script>
    </body>
</html>
